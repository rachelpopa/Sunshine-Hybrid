<!DOCTYPE HTML>
<html>
	<head>
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta http-equiv='Content-Type' content='text/html;charset=UTF-8'/>
		
		<title>Sunshine</title>
		
		<script src="resources/sap-ui-core.js" 
            id="sap-ui-bootstrap"
            data-sap-ui-libs="sap.m,sap.ui.layout" 
            data-sap-ui-xx-bindingSyntax="complex"
            data-sap-ui-theme="sap_bluecrystal"
            data-sap-ui-compatVersion='edge'
            data-sap-ui-preload="sync"
            data-sap-ui-resourceroots='{
                "sap.ui.sunshine.wt": "./"
                }'>
        </script>
		<!-- load the mobile lib "sap.m", the layout lib and the "sap_bluecrystal" theme -->
		
		
		<script type="text/javascript">
			
			// create some dummy JSON data
			
			var data = {  
				  "city":{  
					"id":6119109,
					"name":"Regina",
					"coord":{  
					  "lon":-104.617798,
					  "lat":50.450081
					},
					"country":"CA",
					"population":0
				  },
				  "cod":"200",
				  "message":0.0246,
				  "cnt":14,
				  "list":[  
					{  
					  "dt":1445536800,
					  "temp":{  
						"day":7.17,
						"min":1.76,
						"max":7.17,
						"night":1.76,
						"eve":7.17,
						"morn":7.17
					  },
					  "pressure":957.37,
					  "humidity":53,
					  "weather":[  
						{  
						  "id":800,
						  "main":"Clear",
						  "description":"sky is clear",
						  "icon":"01n"
						}
					  ],
					  "speed":1.57,
					  "deg":246,
					  "clouds":0
					},
					{  
					  "dt":1445623200,
					  "temp":{  
						"day":6.48,
						"min":-2.71,
						"max":8.49,
						"night":-2.71,
						"eve":6.5,
						"morn":1.72
					  },
					  "pressure":962.66,
					  "humidity":55,
					  "weather":[  
						{  
						  "id":800,
						  "main":"Clear",
						  "description":"sky is clear",
						  "icon":"01d"
						}
					  ],
					  "speed":5.57,
					  "deg":327,
					  "clouds":0
					},
					{  
					  "dt":1445709600,
					  "temp":{  
						"day":9.68,
						"min":-2.06,
						"max":11.45,
						"night":3.82,
						"eve":7.77,
						"morn":-2.06
					  },
					  "pressure":962.74,
					  "humidity":51,
					  "weather":[  
						{  
						  "id":802,
						  "main":"Clouds",
						  "description":"scattered clouds",
						  "icon":"03d"
						}
					  ],
					  "speed":3.26,
					  "deg":241,
					  "clouds":48
					},
					{  
					  "dt":1445796000,
					  "temp":{  
						"day":7.04,
						"min":-3.61,
						"max":8.06,
						"night":-3.61,
						"eve":5.95,
						"morn":3.11
					  },
					  "pressure":969.16,
					  "humidity":78,
					  "weather":[  
						{  
						  "id":500,
						  "main":"Rain",
						  "description":"light rain",
						  "icon":"10d"
						}
					  ],
					  "speed":3.96,
					  "deg":326,
					  "clouds":56,
					  "rain":2.12
					},
					{  
					  "dt":1445882400,
					  "temp":{  
						"day":5.44,
						"min":-2.98,
						"max":6.05,
						"night":2.55,
						"eve":6.05,
						"morn":-2.98
					  },
					  "pressure":960.22,
					  "humidity":0,
					  "weather":[  
						{  
						  "id":500,
						  "main":"Rain",
						  "description":"light rain",
						  "icon":"10d"
						}
					  ],
					  "speed":2.23,
					  "deg":118,
					  "clouds":31,
					  "rain":0.24
					},
					{  
					  "dt":1445968800,
					  "temp":{  
						"day":3.65,
						"min":1.19,
						"max":3.69,
						"night":1.19,
						"eve":3.69,
						"morn":2.79
					  },
					  "pressure":963.78,
					  "humidity":0,
					  "weather":[  
						{  
						  "id":500,
						  "main":"Rain",
						  "description":"light rain",
						  "icon":"10d"
						}
					  ],
					  "speed":5.75,
					  "deg":113,
					  "clouds":98,
					  "rain":2.63
					},
					{  
					  "dt":1446055200,
					  "temp":{  
						"day":7.08,
						"min":1.37,
						"max":8.9,
						"night":4.84,
						"eve":8.9,
						"morn":1.37
					  },
					  "pressure":960.04,
					  "humidity":0,
					  "weather":[  
						{  
						  "id":800,
						  "main":"Clear",
						  "description":"sky is clear",
						  "icon":"01d"
						}
					  ],
					  "speed":5.56,
					  "deg":178,
					  "clouds":27
					},
					{  
					  "dt":1446141600,
					  "temp":{  
						"day":7.45,
						"min":2.44,
						"max":7.85,
						"night":2.44,
						"eve":7.85,
						"morn":2.69
					  },
					  "pressure":951.33,
					  "humidity":0,
					  "weather":[  
						{  
						  "id":800,
						  "main":"Clear",
						  "description":"sky is clear",
						  "icon":"01d"
						}
					  ],
					  "speed":5.02,
					  "deg":276,
					  "clouds":12
					},
					{  
					  "dt":1446228000,
					  "temp":{  
						"day":10.52,
						"min":3.05,
						"max":11.73,
						"night":8.21,
						"eve":11.73,
						"morn":3.05
					  },
					  "pressure":944,
					  "humidity":0,
					  "weather":[  
						{  
						  "id":800,
						  "main":"Clear",
						  "description":"sky is clear",
						  "icon":"01d"
						}
					  ],
					  "speed":4.09,
					  "deg":259,
					  "clouds":0
					},
					{  
					  "dt":1446314400,
					  "temp":{  
						"day":9.22,
						"min":1.11,
						"max":9.22,
						"night":1.11,
						"eve":8.34,
						"morn":3.91
					  },
					  "pressure":951.88,
					  "humidity":0,
					  "weather":[  
						{  
						  "id":800,
						  "main":"Clear",
						  "description":"sky is clear",
						  "icon":"01d"
						}
					  ],
					  "speed":5.75,
					  "deg":292,
					  "clouds":0
					},
					{  
					  "dt":1446400800,
					  "temp":{  
						"day":9.66,
						"min":-2.31,
						"max":11.19,
						"night":9.7,
						"eve":11.19,
						"morn":-2.31
					  },
					  "pressure":952.14,
					  "humidity":0,
					  "weather":[  
						{  
						  "id":800,
						  "main":"Clear",
						  "description":"sky is clear",
						  "icon":"01d"
						}
					  ],
					  "speed":5.56,
					  "deg":161,
					  "clouds":46
					},
					{  
					  "dt":1446487200,
					  "temp":{  
						"day":14.18,
						"min":9.38,
						"max":14.18,
						"night":10.7,
						"eve":11.81,
						"morn":9.38
					  },
					  "pressure":944.33,
					  "humidity":0,
					  "weather":[  
						{  
						  "id":500,
						  "main":"Rain",
						  "description":"light rain",
						  "icon":"10d"
						}
					  ],
					  "speed":4.36,
					  "deg":263,
					  "clouds":18
					},
					{  
					  "dt":1446573600,
					  "temp":{  
						"day":17.99,
						"min":12.85,
						"max":17.99,
						"night":12.85,
						"eve":15.97,
						"morn":13.58
					  },
					  "pressure":942.78,
					  "humidity":0,
					  "weather":[  
						{  
						  "id":800,
						  "main":"Clear",
						  "description":"sky is clear",
						  "icon":"01d"
						}
					  ],
					  "speed":7.26,
					  "deg":277,
					  "clouds":0
					},
					{  
					  "dt":1446660000,
					  "temp":{  
						"day":14.21,
						"min":7.7,
						"max":14.21,
						"night":7.7,
						"eve":12.21,
						"morn":11.83
					  },
					  "pressure":946.9,
					  "humidity":0,
					  "weather":[  
						{  
						  "id":500,
						  "main":"Rain",
						  "description":"light rain",
						  "icon":"10d"
						}
					  ],
					  "speed":6.36,
					  "deg":282,
					  "clouds":3,
					  "rain":0.53
					}
				  ]
				};
			
            Date.prototype.getJulian = function() {
                return Math.floor((this / 86400000) -
                (this.getTimezoneOffset()/1440) + 2440587.5);
                }
            
            function getDay(time) {
                // The day string for forecast uses the following logic:
                // For today: "Today, June 8"
                // For tomorrow:  "Tomorrow"
                // For the next 5 days: "Wednesday" (just the day name)
                // For all days after that: "Mon Jun 8"
                
                var currentDate = new Date();
                var currentJulianDay = currentDate.getJulian(); 
                
                var forecastDate = new Date(time);
                var forecastJulianDay = forecastDate.getJulian();
                
                // If the date we're building the String for is today's date, the format
                // is "Today, June 24"
                if (forecastJulianDay == currentJulianDay) {
                    return "Today, " + getFullMonth(forecastDate.getMonth()) + " " + forecastDate.getDate();

                } else if ( forecastJulianDay < currentJulianDay + 7 ) {
                    // If the input date is less than a week in the future, just return the day name.
                    return getFullWeekDay(forecastDate.getDay());
                } else {
                    // Otherwise, use the form "Mon Jun 3"
                   return getShortWeekDay(forecastDate.getDay()) + " " + getShortMonth(forecastDate.getMonth()) + " " + forecastDate.getDate();
                }
            }
            
            function getFullDate(time) {
                var forecastDate = new Date(time);
                return getShortMonth(forecastDate.getMonth()) + " " + forecastDate.getDate() + ", " + forecastDate.getFullYear();
            }
            
            function getFullWeekDay(code) {
                var day = "";
                switch(code) {
                            case 0:
                                day = "Sunday";
                                break;
                            case 1:
                                day = "Monday";
                                break;
                            case 2:
                                day = "Tuesday";
                                break;
                            case 3:
                                day = "Wednesday";
                                break;
                            case 4:
                                day = "Thursday";
                                break;
                            case 5:
                                day = "Friday";
                                break;
                            case 6:
                                day = "Saturday";
                                break;
                        }
                return day;
            }
            
            function getShortWeekDay(code) {
            var day = "";
                switch(code) {
                            case 0:
                                day = "Sun";
                                break;
                            case 1:
                                day = "Mon";
                                break;
                            case 2:
                                day = "Tue";
                                break;
                            case 3:
                                day = "Wed";
                                break;
                            case 4:
                                day = "Thu";
                                break;
                            case 5:
                                day = "Fri";
                                break;
                            case 6:
                                day = "Sat";
                                break;
                        }
                return day;
            }
            
            function getFullMonth(code) {
                var month = "";
                switch (code){
                    case 0:
                        month = "January";
                        break;
                    case 1:
                        month = "February";
                        break;
                    case 2:
                        month = "March";
                        break;
                    case 3:
                        month = "April";
                        break;
                    case 4:
                        month = "May";
                        break;
                    case 5:
                        month = "June";
                        break;
                    case 6:
                        month = "July";
                        break;
                    case 7:
                        month = "August";
                        break;
                    case 8:
                        month = "September";
                        break;
                    case 9:
                        month = "October";
                        break;
                    case 10:
                        month = "November";
                        break;
                    case 11:
                        month = "December";
                        break;
                }
                return month;
            }
            
            function getShortMonth(code) {
                var month = "";
                switch (code){
                    case 0:
                        month = "Jan";
                        break;
                    case 1:
                        month = "Feb";
                        break;
                    case 2:
                        month = "Mar";
                        break;
                    case 3:
                        month = "Apr";
                        break;
                    case 4:
                        month = "May";
                        break;
                    case 5:
                        month = "Jun";
                        break;
                    case 6:
                        month = "Jul";
                        break;
                    case 7:
                        month = "Aug";
                        break;
                    case 8:
                        month = "Sep";
                        break;
                    case 9:
                        month = "Oct";
                        break;
                    case 10:
                        month = "Nov";
                        break;
                    case 11:
                        month = "Dec";
                        break;
                }
                return month;
            }
            
            function getIcon(weatherId) {
                // Based on weather code data found at:
                // http://bugs.openweathermap.org/projects/api/wiki/Weather_Condition_Codes
                if (weatherId >= 200 && weatherId <= 232) {
                    return "ic_storm.png";
                } else if (weatherId >= 300 && weatherId <= 321) {
                    return "ic_light_rain.png";
                } else if (weatherId >= 500 && weatherId <= 504) {
                    return "ic_rain.png";
                } else if (weatherId == 511) {
                    return "ic_snow.png";
                } else if (weatherId >= 520 && weatherId <= 531) {
                    return "ic_rain.png";
                } else if (weatherId >= 600 && weatherId <= 622) {
                    return "ic_snow.png";
                } else if (weatherId >= 701 && weatherId <= 761) {
                    return "ic_fog.png";
                } else if (weatherId == 761 || weatherId == 781) {
                    return "ic_storm.png";
                } else if (weatherId == 800) {
                    return "ic_clear.png";
                } else if (weatherId == 801) {
                    return "ic_light_clouds.png";
                } else if (weatherId >= 802 && weatherId <= 804) {
                    return "ic_cloudy.png";
                }
                return "ic_clear.png";
            }
            
            function getImage(weatherId) {
                // Based on weather code data found at:
                // http://bugs.openweathermap.org/projects/api/wiki/Weather_Condition_Codes
                if (weatherId >= 200 && weatherId <= 232) {
                    return "art_storm.png";
                } else if (weatherId >= 300 && weatherId <= 321) {
                    return "art_light_rain.png";
                } else if (weatherId >= 500 && weatherId <= 504) {
                    return "art_rain.png";
                } else if (weatherId == 511) {
                    return "art_snow.png";
                } else if (weatherId >= 520 && weatherId <= 531) {
                    return "art_rain.png";
                } else if (weatherId >= 600 && weatherId <= 622) {
                    return "art_snow.png";
                } else if (weatherId >= 701 && weatherId <= 761) {
                    return "art_fog.png";
                } else if (weatherId == 761 || weatherId == 781) {
                    return "art_storm.png";
                } else if (weatherId == 800) {
                    return "art_clear.png";
                } else if (weatherId == 801) {
                    return "art_light_clouds.png";
                } else if (weatherId >= 802 && weatherId <= 804) {
                    return "art_cloudy.png";
                }
                return "art_clear.png";
            }
            
			// create a Model with this data
			var model = new sap.ui.model.json.JSONModel();
			//model.setData(data);
            model.loadData("http://api.openweathermap.org/data/2.5/forecast/daily?id=524901&APPID=KEY-REMOVED&q=Regina&mode=json&units=metric&cnt=14", "", false);

            var listData = model.getProperty("/list"); 

            var updatedList = [];
            
            for(var i = 0; i < listData.length; i++) {
               // alert(listData[i].dt);
               var listItem = listData[i];
               //dt is in seconds so it is converted into milliseconds for the date conversion
                listItem.day = getDay(listItem.dt*1000);
                listItem.date = getFullDate(listItem.dt*1000);
                listItem.icon = getIcon(listItem.weather[0].id);
                listItem.image = getImage(listItem.weather[0].id);
                updatedList.push(listItem);
            }
            
			// create the UI
            
            var list = new sap.ui.xmlview({
               viewName : "sap.ui.sunshine.wt.List"
            });
                     
			//create the page holding the List
			var page1 = new sap.m.Page({
                showHeader : false,
				content : list
			});
            
            var details = new sap.ui.xmlview({
                viewName : "sap.ui.sunshine.wt.Details"
            });
            
            // create the detail page
            var page2 = new sap.m.Page("page2", {
                title: "Details",
                showNavButton: true,
                navButtonPress: function(){
                    app.back();
                },
                content : details
            });
			
			// create a mobile App holding the pages and place the App into the HTML document
			var app = new sap.m.App({
				pages: [page1, page2]
			}).placeAt("content");
			
			// set the model to the App; it will be propagated to the children
			app.setModel(model);
			
		</script>
		
	</head>
	<body id="content" class="sapUiBody">
	</body>
</html> 